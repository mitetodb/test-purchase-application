<!DOCTYPE html>
<html lang="en" th:replace="~{layout :: layout(~{::title}, ~{::main})}"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Test Purchase Details</title>
</head>
<body>
<main>
<h2>Test Purchase Details</h2>

<div class="mb-3">
    <label>Id:</label> <span th:text="${purchase.id}"></span>
</div>

<div class="mb-3">
    <label>Customer:</label> <span th:text="${purchase.customer.name}"></span>
</div>

<div class="mb-3">
    <label>Shop:</label> <span th:text="${purchase.shop.name}"></span>
</div>

<div class="mb-3">
    <label>Status:</label> <span th:text="${purchase.status}"></span>
</div>

<div class="mb-3">
    <label>Total Price:</label> <span th:text="${purchase.totalPrice}"></span>
</div>

<h5>Items</h5>
<table class="table">
    <thead>
    <tr>
        <th>Product</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>Subtotal</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="i : ${purchase.items}">
        <td th:text="${i.productName}"></td>
        <td th:text="${i.quantity}"></td>
        <td th:text="${i.unitPrice}"></td>
        <td th:text="${i.quantity * i.unitPrice}"></td>
    </tr>
    </tbody>
</table>

    <h5>Attachments</h5>

    <form th:action="@{/attachments/upload}" method="post" enctype="multipart/form-data">
        <input type="hidden" name="testPurchaseId" th:value="${purchase.id}"/>
        <input type="file" name="file" required/>
        <select name="category">
            <option value="">--Category (optional)--</option>
            <option th:each="c : ${T(app.model.enums.AttachmentCategory).values()}"
                    th:value="${c}" th:text="${c}"></option>
        </select>
        <button class="btn btn-primary" type="submit">Upload</button>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
    </form>

    <ul class="list-group mt-3">
        <li class="list-group-item" th:each="att : ${attachments}">
            <span th:text="${att.name}">File</span>
            <a th:href="@{'/attachments/' + ${att.id} + '/download'}" class="btn btn-sm btn-secondary ms-2">Download</a>

            <form th:action="@{'/attachments/delete/' + ${att.id}}" method="post" style="display:inline;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button class="btn btn-sm btn-danger ms-2" type="submit">Delete</button>
            </form>
        </li>
    </ul>

    <a th:href="@{/testpurchases}" class="btn btn-secondary">Back</a>
</main>
</body>
</html>